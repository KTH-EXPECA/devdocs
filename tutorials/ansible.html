
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Manuel Olguín Muñoz">
      
      
        <link rel="canonical" href="https://expeca.proj.kth.se/devdocs/tutorials/ansible.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Ansible - EXPECA Testbed Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/timeago.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="EXPECA Testbed Developer Documentation" class="md-header__button md-logo" aria-label="EXPECA Testbed Developer Documentation" data-md-component="logo">
      
  <img src="../assets/kth_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EXPECA Testbed Developer Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ansible
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/KTH-EXPECA/devdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KTH-EXPECA/devdocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="sshing_into_the_lab.html" class="md-tabs__link md-tabs__link--active">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../technical_documents/hardware_inventory.html" class="md-tabs__link">
        Technical documents
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../notes_for_the_future.html" class="md-tabs__link">
      Notes for the future
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="EXPECA Testbed Developer Documentation" class="md-nav__button md-logo" aria-label="EXPECA Testbed Developer Documentation" data-md-component="logo">
      
  <img src="../assets/kth_logo.png" alt="logo">

    </a>
    EXPECA Testbed Developer Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KTH-EXPECA/devdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KTH-EXPECA/devdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sshing_into_the_lab.html" class="md-nav__link">
        Accessing the lab remotely
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="adding_documentation.html" class="md-nav__link">
        Editing documentation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Ansible
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="ansible.html" class="md-nav__link md-nav__link--active">
        Ansible
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#containerized-setup" class="md-nav__link">
    Containerized Setup
  </a>
  
    <nav class="md-nav" aria-label="Containerized Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-workings-of-the-environment" class="md-nav__link">
    Inner workings of the environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-setup" class="md-nav__link">
    Updating the setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bare-bones" class="md-nav__link">
    Bare-bones
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-structure" class="md-nav__link">
    Configuration structure
  </a>
  
    <nav class="md-nav" aria-label="Configuration structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-inventory" class="md-nav__link">
    The inventory
  </a>
  
    <nav class="md-nav" aria-label="The inventory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-note-about-the-inventory" class="md-nav__link">
    Important note about the inventory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#playbooks" class="md-nav__link">
    Playbooks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ips_dns_bindings.html" class="md-nav__link">
        Setting IP addresses and DNS bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" data-md-state="indeterminate" type="checkbox" id="__nav_2_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_1" data-md-state="indeterminate" type="checkbox" id="__nav_2_5_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_1">
          Hardware setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware setup" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_1">
          <span class="md-nav__icon md-icon"></span>
          Hardware setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deployment/hardware_setup/raspberrypis.html" class="md-nav__link">
        Setting up the Raspberry Pi 4B clients
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deployment/hardware_setup/x86hosts.html" class="md-nav__link">
        Setting up the x86 hosts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_2" data-md-state="indeterminate" type="checkbox" id="__nav_2_5_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_2">
          Software setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software setup" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_2">
          <span class="md-nav__icon md-icon"></span>
          Software setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deployment/software_setup/Fluent.html" class="md-nav__link">
        Fluent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deployment/software_setup/ansible.html" class="md-nav__link">
        Ansible
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deployment/software_setup/ntp.html" class="md-nav__link">
        Time synchronization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" data-md-state="indeterminate" type="checkbox" id="__nav_2_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Project course
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Project course" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Project course
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="project_course/aws.html" class="md-nav__link">
        Accessing the AWS test instances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="project_course/deploying.html" class="md-nav__link">
        Deploying a workload to the Testbed
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Technical documents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Technical documents" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Technical documents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical_documents/hardware_inventory.html" class="md-nav__link">
        Hardware Inventory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical_documents/management_overview.html" class="md-nav__link">
        Management Network Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Workload definitions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workload definitions" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Workload definitions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical_documents/workload_definitions/overview.html" class="md-nav__link">
        Workload Definition Schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../notes_for_the_future.html" class="md-nav__link">
        Notes for the future
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/KTH-EXPECA/devdocs/edit/master/docs/tutorials/ansible.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="ansible">Ansible<a class="headerlink" href="#ansible" title="Permanent link">🔗</a></h1>
<p>We use <a href="https://www.ansible.com/">Red Hat Ansible</a> for centralized configuration of the testbed from <code>galadriel</code>.
This page presents an overview and "crash course" in using it on the ExPECA testbed; for more details, head to the <a href="https://docs.ansible.com/">official documentation</a>.</p>
<h2 id="containerized-setup">Containerized Setup<a class="headerlink" href="#containerized-setup" title="Permanent link">🔗</a></h2>
<p>In order to avoid issues with mismatching software versions and configurations, we have a containerized setup for general usage of Ansible on the testbed.
It consists of a Docker image containing Ansible, required Ansible Galaxy collections, and the necessary configuration for use on the testbed (<code>ansible.cfg</code> and the <a href="#the-inventory">inventory</a>).
This Docker image can be found as <a href="https://hub.docker.com/r/expeca/ansible">expeca/ansible</a> on <a href="https://hub.docker.com">Docker Hub</a>.</p>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">🔗</a></h3>
<p>In the <code>ansible</code> subdirectory of the <a href="https://github.com/KTH-EXPECA/TestbedConfig/tree/master/ansible"><code>KTH-EXPECA/TestbedConfig</code></a> repository you will find a script named <a href="https://github.com/KTH-EXPECA/TestbedConfig/tree/master/ansible/activate_config_env"><code>activate_config_env</code></a> which can be <code>source</code>'d to activate a "virtual environment" under which all Ansible commands will be run inside the container:</p>
<ol>
<li>Navigate to the <code>ansible</code> subdirectory of the <a href="https://github.com/KTH-EXPECA/TestbedConfig/tree/master/ansible"><code>KTH-EXPECA/TestbedConfig</code></a> repository.</li>
<li>
<p>Source the <code>activate_config_env</code> script:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>$ <span class="nb">source</span> activate_config_env
<span class="linenos" data-linenos="2 "></span>INFO: Activating config container environment.
<span class="linenos" data-linenos="3 "></span><span class="o">(</span>config<span class="o">)</span> $
</code></pre></div>
</li>
<li>
<p>All Ansible commands in this mode run inside the container, by default against the static Ansible configuration and inventory stored inside it.
   However, the commands also mount the current directory inside the container, allowing the running of playbooks, roles, and even specifying custom temporary configurations and inventories, as long as these files reside in the current directory or a subdirectory thereof. Examples:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># simply runs the ping module against the elrond host </span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1"># defined in the container inventory</span>
<span class="linenos" data-linenos=" 3 "></span><span class="o">(</span>config<span class="o">)</span> $ ansible elrond -m ping
<span class="linenos" data-linenos=" 4 "></span>INFO: Running Ansible <span class="k">in</span> config container!
<span class="linenos" data-linenos=" 5 "></span>------------------------------------------
<span class="linenos" data-linenos=" 6 "></span>elrond <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="s2">&quot;ansible_facts&quot;</span>: <span class="o">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s2">&quot;discovered_interpreter_python&quot;</span>: <span class="s2">&quot;/usr/bin/python3&quot;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="o">}</span>,
<span class="linenos" data-linenos="10 "></span>    <span class="s2">&quot;changed&quot;</span>: false,
<span class="linenos" data-linenos="11 "></span>    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="o">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="c1"># runs the configure_auth.yml playbook, which resides under the current</span>
<span class="linenos" data-linenos="15 "></span><span class="c1"># directory OUTSIDE of the container, by mounting it inside.</span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># the playbook is still run against the container inventory though.</span>
<span class="linenos" data-linenos="17 "></span><span class="o">(</span>config<span class="o">)</span> $ ansible-playbook configure_auth.yml 
<span class="linenos" data-linenos="18 "></span>INFO: Running Ansible <span class="k">in</span> config container!
<span class="linenos" data-linenos="19 "></span>------------------------------------------
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>PLAY <span class="o">[</span>Update auth <span class="k">for</span> the expeca user<span class="o">]</span> *********************************************************
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *************************************************************************
<span class="linenos" data-linenos="24 "></span>ok: <span class="o">[</span>elrond<span class="o">]</span>
<span class="linenos" data-linenos="25 "></span>ok: <span class="o">[</span>celeborn<span class="o">]</span>
<span class="linenos" data-linenos="26 "></span>ok: <span class="o">[</span>galadriel<span class="o">]</span>
<span class="linenos" data-linenos="27 "></span>...
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="c1"># overrides the inventory built into the container by specifying the</span>
<span class="linenos" data-linenos="30 "></span><span class="c1"># -i flag, in order to -- for instance -- test a new host config.</span>
<span class="linenos" data-linenos="31 "></span><span class="c1"># note that the new inventory must be located under the current directory</span>
<span class="linenos" data-linenos="32 "></span><span class="c1"># or inside a subfolder of it, and the path to it specified relatively.</span>
<span class="linenos" data-linenos="33 "></span><span class="o">(</span>config<span class="o">)</span> $ ansible-playbook -i custom_inventory/hosts.yml configure_auth.yml 
<span class="linenos" data-linenos="34 "></span>INFO: Running Ansible <span class="k">in</span> config container!
<span class="linenos" data-linenos="35 "></span>------------------------------------------
<span class="linenos" data-linenos="36 "></span>
<span class="linenos" data-linenos="37 "></span>PLAY <span class="o">[</span>Update auth <span class="k">for</span> the expeca user<span class="o">]</span> *********************************************************
<span class="linenos" data-linenos="38 "></span>
<span class="linenos" data-linenos="39 "></span>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *************************************************************************
<span class="linenos" data-linenos="40 "></span>ok: <span class="o">[</span>elrond<span class="o">]</span>
<span class="linenos" data-linenos="41 "></span>ok: <span class="o">[</span>celeborn<span class="o">]</span>
<span class="linenos" data-linenos="42 "></span>ok: <span class="o">[</span>galadriel<span class="o">]</span>
<span class="linenos" data-linenos="43 "></span>...
</code></pre></div>
</li>
<li>
<p>The config environment also provides a <code>config-container-cmd</code> to run arbitrary commands inside the continer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">(</span>config<span class="o">)</span> $ config-container-cmd bash
<span class="linenos" data-linenos="2 "></span>INFO: Running <span class="nb">command</span> <span class="k">in</span> config container!
<span class="linenos" data-linenos="3 "></span>------------------------------------------
<span class="linenos" data-linenos="4 "></span>root@galadriel:/opt/workdir#
</code></pre></div>
</li>
<li>
<p>When finished using the config environment, you can exit it by running <code>deactivate_config_env</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="o">(</span>config<span class="o">)</span> $ deactivate_config_env
<span class="linenos" data-linenos="2 "></span>INFO: Deactivating config container environment.
<span class="linenos" data-linenos="3 "></span>$ 
</code></pre></div>
</li>
</ol>
<h4 id="inner-workings-of-the-environment">Inner workings of the environment<a class="headerlink" href="#inner-workings-of-the-environment" title="Permanent link">🔗</a></h4>
<p>The <code>activate_config_env</code> file is a Bash/Zsh source file which defines aliases for the Ansilbe CLI commands, as well as a function <code>deactivate_config_env</code> which resets everything to the state it was before entering the environment.
The defined aliases replace the normal Ansible commands with commands which:</p>
<ol>
<li>Pull the required Docker image, if needed.</li>
<li>
<p>Run the container in the following manner:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker run --rm -it --network host -e <span class="nv">SSH_AUTH_SOCK</span><span class="o">=</span>/ssh-agent <span class="se">\</span>
<span class="linenos" data-linenos="2 "></span>  -v <span class="si">${</span><span class="nv">SSH_AUTH_SOCK</span><span class="si">}</span>:/ssh-agent:rw -v <span class="se">\$</span><span class="o">{</span>PWD<span class="o">}</span>:/opt/workdir:rw <span class="si">${</span><span class="nv">IMAGE</span><span class="si">}</span>
</code></pre></div>
<p>Explanation:</p>
<ul>
<li><code>--network host</code>: use the host network interfaces directly.</li>
<li><code>-e SSH_AUTH_SOCK=/ssh-agent -v ${SSH_AUTH_SOCK}:/ssh-agent:rw</code>: forwards the host SSH-agent to the container.
      This is of course necessary to allow Ansible inside the container to authenticate agains the testbed hosts.</li>
<li><code>-v \${PWD}:/opt/workdir:rw</code> mounts the current working directory inside the container, to allow access to playbooks, roles, and custom configurations without having to rebuild the container.</li>
</ul>
</li>
<li>
<p>Finally, run the requested command inside the container.</p>
</li>
</ol>
<h3 id="updating-the-setup">Updating the setup<a class="headerlink" href="#updating-the-setup" title="Permanent link">🔗</a></h3>
<p>In case the static Ansible configuration/inventory inside the container needs to be updated, simply make any required modifications in the <code>ansible</code> subdirectory of the <a href="https://github.com/KTH-EXPECA/TestbedConfig/tree/master/ansible"><code>KTH-EXPECA/TestbedConfig</code></a> repository.
Then, use the provided <code>Makefile</code> to build and push the container image to Docker Hub:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>$ <span class="nb">cd</span> TestbedConfig/ansible
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="c1"># make your changes</span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># then build and push using GNU Make</span>
<span class="linenos" data-linenos="5 "></span>
<span class="linenos" data-linenos="6 "></span>$ make ansible-container
<span class="linenos" data-linenos="7 "></span>... 
</code></pre></div>
<h2 id="bare-bones">Bare-bones<a class="headerlink" href="#bare-bones" title="Permanent link">🔗</a></h2>
<p>A bare-bones setup should only be used when strictly needed, prefer to use the containerized deployment described above to avoid configuration mismatch issues.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">🔗</a></h2>
<p>Ansible should be installed from first boot on <code>galadriel</code>.
If this is not the case, or if for some reason it needs to be reconfigured, installation is straightforward --- simply install the <code>ansible</code> package through <code>apt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">sudo apt install ansible</span>
</code></pre></div>
<p>Alternatively, since it is built on Python, Ansible can be run from a local virtual environment.
Simply create the environment (make sure it is a Python3+ environment) inside the <code>ansible</code> subdirectory of the <code>KTH-EXPECA/TestbedConfig</code> repository, activate it, then use <code>pip</code> to install Ansible:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="gp">$ </span><span class="nb">cd</span> ansible/
<span class="linenos" data-linenos=" 2 "></span><span class="go">./ansible/</span>
<span class="linenos" data-linenos=" 3 "></span><span class="gp">$ </span>python3 -m virtualenv --python<span class="o">=</span>python3 ./venv 
<span class="linenos" data-linenos=" 4 "></span><span class="go">created virtual environment CPython3.9.6.final.0-64 in 152ms</span>
<span class="linenos" data-linenos=" 5 "></span><span class="go">...</span>
<span class="linenos" data-linenos=" 6 "></span><span class="gp">$ </span>. venv/bin/activate
<span class="linenos" data-linenos=" 7 "></span><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>pip install -U ansible
<span class="linenos" data-linenos=" 8 "></span><span class="go">Collecting ansible</span>
<span class="linenos" data-linenos=" 9 "></span><span class="go">  Downloading ansible-4.3.0.tar.gz (35.1 MB)</span>
<span class="linenos" data-linenos="10 "></span><span class="go">...</span>
</code></pre></div>
<h2 id="usage_1">Usage<a class="headerlink" href="#usage_1" title="Permanent link">🔗</a></h2>
<p>Our Ansible configuration is fully contained inside the <code>ansible</code> subdirectory of the <code>KTH-EXPECA/TestbedConfig</code> repository; it is not installed system-wide, mostly for portability reasons.
Thus, whenever using Ansible, whether through ad-hoc commands or using playbooks, you will need to specify the correct configuration.
This can be done in two ways:</p>
<ol>
<li>
<p>The easiest way is to <code>cd</code> into the <code>ansible</code> subdirectory of the <code>KTH-EXPECA/TestbedConfig</code> repository.
  Running Ansible from this directory will cause it to automatically detect the corresponding configuration, i.e.:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="gp">$ </span><span class="nb">cd</span> TestbedConfig/ansible
<span class="linenos" data-linenos="2 "></span><span class="go">TestbedConfig/ansible</span>
<span class="linenos" data-linenos="3 "></span><span class="gp">$ </span>ansible all -m ping
<span class="linenos" data-linenos="4 "></span><span class="go">...</span>
</code></pre></div>
</li>
<li>
<p>Alternatively, or if for some reason you need to run it from a different directory, you can explicitly tell Ansible which configuration file to use through the <code>ANSIBLE_CONFIG</code> environment variable.</p>
<ul>
<li>
<p>You can set this variable by specifying it before the command to run on the command line:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="gp">$ </span><span class="nv">ANSIBLE_CONFIG</span><span class="o">=</span>~/TestbedConfig/ansible/ansible.cfg ansible all -m ping
<span class="linenos" data-linenos="2 "></span><span class="go">...</span>
</code></pre></div>
</li>
<li>
<p>If you wish to run multiple commands, it might also be easier to <code>export</code> the variable:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">ANSIBLE_CONFIG</span><span class="o">=</span>~/TestbedConfig/ansible/ansible.cfg
<span class="linenos" data-linenos="2 "></span><span class="gp">$ </span>ansible all -m ping
<span class="linenos" data-linenos="3 "></span><span class="go">...</span>
<span class="linenos" data-linenos="4 "></span><span class="gp">$ </span>ansible-playbook example_playbook.yml
<span class="linenos" data-linenos="5 "></span><span class="go">...</span>
</code></pre></div>
<p>This way, the variable will be set to the correct value until you log out.</p>
</li>
</ul>
</li>
</ol>
<h2 id="configuration-structure">Configuration structure<a class="headerlink" href="#configuration-structure" title="Permanent link">🔗</a></h2>
<p>We use an Ansible configuration directory structure which somewhat follows the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">official guidelines detailed here.</a>
It looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>ansible
<span class="linenos" data-linenos=" 2 "></span>├── ansible.cfg
<span class="linenos" data-linenos=" 3 "></span>├── inventory
<span class="linenos" data-linenos=" 4 "></span>│   ├── group_vars
<span class="linenos" data-linenos=" 5 "></span>│   │   └── all.yml
<span class="linenos" data-linenos=" 6 "></span>│   ├── hosts.yml
<span class="linenos" data-linenos=" 7 "></span>├── requirements.txt
<span class="linenos" data-linenos=" 8 "></span>├── requirements.yml
<span class="linenos" data-linenos=" 9 "></span>├── roles
<span class="linenos" data-linenos="10 "></span>│   ├── role1
<span class="linenos" data-linenos="11 "></span>│   │   └── ...
<span class="linenos" data-linenos="12 "></span>│   ├── ...
<span class="linenos" data-linenos="13 "></span>│   │   └── ...
<span class="linenos" data-linenos="14 "></span>│   └── roleN
<span class="linenos" data-linenos="15 "></span>│       └── ...
<span class="linenos" data-linenos="16 "></span>├── playbook1.yml
<span class="linenos" data-linenos="17 "></span>├── ...
<span class="linenos" data-linenos="18 "></span>├── playbookN.yml
<span class="linenos" data-linenos="19 "></span>└── vars
<span class="linenos" data-linenos="20 "></span>    └── auth.yml
</code></pre></div>
<h3 id="the-inventory">The inventory<a class="headerlink" href="#the-inventory" title="Permanent link">🔗</a></h3>
<p>The <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">Ansible inventory</a> for the testbed is contained under <code>inventory/</code>
It is structured in the following manner:</p>
<ul>
<li><code>inventory/hosts.yml</code> contains the base structure of the hosts of the network and some variables.</li>
<li><code>inventory/group_vars</code> contains the common and/or default variables for each host group.
  Each file corresponds to the group with the same name in the <code>hosts.yml</code> file.
  The most interesting of these files is the one corresponding to the <code>all</code> group, which contains defaults and common variables for <em>all</em> the hosts.</li>
<li>Finally, <code>inventory/host_vars</code> potentially contains one YAML file per host in the configuration.
  These files contain Ansible variables specific to each host in the testbed, some of which may override the inherited variables from the corresponding group.</li>
</ul>
<h4 id="important-note-about-the-inventory">Important note about the inventory<a class="headerlink" href="#important-note-about-the-inventory" title="Permanent link">🔗</a></h4>
<p>The management network configuration <a href="./adding_dhcp_dns_bindings.md">is directly tied to our Ansible inventory.</a>
In particular, <strong>hostnames, static IPs, and DNS records</strong> are assigned directly from Ansible host aliases and host/group variables defined in the inventory.
This means that any substantial change in the structure of the inventory, modification of host aliases, or change in any of the relevant host/group variables, will <strong>probably require rebuilding of the management network</strong>.
For more details, see <a href="ips_dns_bindings.html">here</a>.</p>
<h3 id="playbooks">Playbooks<a class="headerlink" href="#playbooks" title="Permanent link">🔗</a></h3>
<p>The YAML files under <code>ansible/</code> correspond to <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">Playbooks</a> for different tasks.
Most of these are written following the structure <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">here</a>; that is, the actual Tasks to be performed are actually parameterized and defined in Roles.
These Roles are contained in the <code>roles/</code> directory.
Each subdirectory corresponds to a role with a matching name.
Again, <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">read this page</a> for more details on the usage of Roles in Playbooks.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2022-05-16T14:17:33+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-05-16</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2022-05-16T14:17:33+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-05-16</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="adding_documentation.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Editing documentation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Editing documentation
            </div>
          </div>
        </a>
      
      
        
        <a href="ips_dns_bindings.html" class="md-footer__link md-footer__link--next" aria-label="Next: Setting IP addresses and DNS bindings" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Setting IP addresses and DNS bindings
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - EXPECA Project Group at KTH Royal Institute of Technology
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "toc.integrate"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="../js/timeago.min.js"></script>
      
        <script src="../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>